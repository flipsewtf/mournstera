---
import Chevron from './icons/Chevron.svg';

const current = Astro.url.pathname;
const isActive = (path: string) => current === path;
---

<button class="menu-toggle" aria-expanded="false" aria-controls="mega" data-menu-btn>
    Explore <Chevron />
</button>

<div class="megamenu" id="mega" data-megamenu>
    <nav aria-label="Main navigation">
        <a href="/about/" aria-current={isActive('/about/') ? 'page' : undefined}>
            <h4>About</h4>
            <p class="desc">Let me indulge and tell you about myself.</p>
        </a>

        <a href="/blog/" aria-current={isActive('/blog/') ? 'page' : undefined}>
            <h4>Blog</h4>
            <p class="desc">More or less coherent thought-out posts.</p>
        </a>

        <a href="/garden/" aria-current={isActive('/garden/') ? 'page' : undefined}>
            <h4>Garden</h4>
            <p class="desc">My garden of thoughts, musings, ideas, and wonder.</p>
        </a>

        <a href="/bag/" aria-current={isActive('/bag/') ? 'page' : undefined}>
            <h4>Bag</h4>
            <p class="desc">A list of the gear I currently use for my workspace.</p>
        </a>
    </nav>
</div>

<style>
    a {
        color: var(--text-primary);
        text-decoration: none;
        transition: color var(--cubic-smooth) border-color var(--cubic-smooth);
    }
    a:hover {
        color: var(--accent-primary);
    }

    button.menu-toggle {
        display: flex;
        gap: var(--4px);
        align-items: center;
        color: var(--text-secondary);
        margin-right: var(--space-1);
        font-weight: 600;
    }

    button.menu-toggle svg {
        width: 1.125rem;
        height: 1.125rem;
        stroke-width: 3;
        transition: transform 0.09s cubic-bezier(0.25, 0.8, 0.3, 1);
    }

    button.menu-toggle:hover svg {
        color: var(--accent-primary);
    }

    button.menu-toggle:active svg {
        transform: scaleX(0.7);
    }

    /* Mobile-first: base styles */
    .megamenu {
        width: 100%;
        max-width: 100%;
        height: calc(100dvh - var(--header-height));
        right: 0;
        z-index: 1;
        position: absolute;
        top: var(--header-height);
        opacity: 1;
        transition: opacity var(--cubic-snappy);
    }

    .megamenu:not(.open) {
        opacity: 0;
        pointer-events: none;
    }

    @media (max-width: 703px) {
        body.noscroll {
            overflow: hidden;
            touch-action: none;
        }
    }

    nav {
        padding: var(--space-3);
        background: var(--bg-secondary);
        display: flex;
        gap: var(--space-3);
        height: 100%;
        flex-direction: column;
        align-items: flex-end;
    }
    h4 {
        font-size: 1.4rem;
        margin: 0;
    }

    nav p.desc {
        display: none;
    }

    /* Desktop overrides */
    /* 536px width of mega menu + 2* var(--layout-padding)/32px, on desktop */
    @media (min-width: 704px) {
        .megamenu {
            width: 40rem;
            height: auto;
            margin-top: calc(-1 * var(--1px));
            right: auto;
        }

        nav {
            display: grid;

            grid-template-columns: repeat(3, 1fr);
            align-items: stretch;
            gap: var(--4px);
            height: auto;
            padding: var(--space-1);
            border-radius: var(--radius-md);
            border: var(--1px) solid var(--border-primary);
            opacity: 1;
            transform: rotateX(0) scale(1);
            transform-origin: top right;
            transition:
                border-radius var(--cubic-smooth),
                transform var(--cubic-snappy);
        }
        .megamenu:not(.open) nav {
            transform: rotateX(-15deg) scale(0.9);
        }

        :global(header.top.scrolled nav) {
            border-radius: 0 0 var(--radius-md) var(--radius-md);
        }

        nav a {
            padding: var(--space-1);
            will-change: transform;
            transform: translateZ(0);
        }

        h4 {
            font-size: var(--h4);
            font-weight: 700;
        }
        nav a:hover h4 {
            color: var(--accent-primary);
        }

        nav p.desc {
            display: block;
            color: var(--text-primary);
            font-size: var(--p-sm);
            line-height: var(--line-height-sub);
            margin: 0;
            margin-top: var(--5px);
        }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
        .megamenu {
            transition: opacity 0.001s linear;
            transform: none;
        }

        .megamenu:not(.open) {
            opacity: 0;
            transform: none;
        }

        button.menu-toggle:active svg {
            transform: none;
        }
    }
</style>

<script src="/scripts/megamenu.js" defer></script>
