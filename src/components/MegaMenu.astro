---
import Chevron from './icons/Chevron.svg';
const current = Astro.url.pathname;
const isActive = (path: string) => current === path;
---

<button class="menu-toggle" aria-expanded="false" aria-controls="mega" data-menu-btn>
    Explore <span class="header-icon"><Chevron /></span>
</button>

<div class="megamenu" id="mega" data-megamenu>
    <nav role="menubar" aria-hidden="true" aria-label="Main navigation">
        <a
            href="/about/"
            role="menuitem"
            aria-current={isActive('/about/') ? 'page' : undefined}
        >
            <h3>About</h3>
            <p class="desc">Let me indulge you in a story</p>
        </a>
        <a href="/bag/" role="menuitem" aria-current={isActive('/bag/') ? 'page' : undefined}>
            <h3>Bag</h3>
            <p class="desc">Desk setup and other main uses</p>
        </a>
        <a href="/blog/" role="menuitem" aria-current={isActive('/blog/') ? 'page' : undefined}>
            <h3>Blog</h3>
            <p class="desc">More or less coherent and long-form thoughts</p>
        </a>
    </nav>
</div>

<style>
    button.menu-toggle {
        display: flex;
        gap: var(--space-0);
        align-items: center;
    }

    button.menu-toggle svg {
        transition: transform 0.15s cubic-bezier(0.25, 0.8, 0.3, 1);
    }

    button.menu-toggle:active svg {
        transform: scaleX(0.7);
    }

    /* Mobile-first: base styles */
    .megamenu {
        width: 100%;
        max-width: 100%;
        height: calc(100dvh - var(--header-height));
        padding: var(--space-3);
        right: 0;
        background: var(--color-bg);
        z-index: 1;
        position: absolute;
        top: var(--header-height);

        transform-origin: top right;
        opacity: 1;
        transform: rotateX(0) scale(1);
        transition:
            opacity 0.28s cubic-bezier(0.25, 0.8, 0.3, 1),
            transform 0.28s cubic-bezier(0.25, 0.8, 0.3, 1);
    }

    .megamenu:not(.open) {
        opacity: 0;
        transform: rotateX(-15deg) scale(0.9);
        pointer-events: none;
    }

    nav {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-3);
        width: 100%;
        align-items: start;
    }

    nav h3,
    nav p {
        margin: 0;
    }

    nav a {
        text-align: right;
        border-radius: 0;
        border: none;
        color: var(--color-text);
    }

    nav p.desc {
        display: none;
    }

    /* Desktop overrides */
    @media (min-width: 560px) {
        .megamenu {
            border-radius: var(--radius-md);
            max-width: 31.25rem;
            height: auto;
            margin-top: var(--space-3);
            right: var(--space-3);
            border: var(--border-thin) solid var(--color-border);
        }

        nav {
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-0);
        }

        nav a {
            padding: var(--space-2);
            border-radius: var(--radius-sm);
            border: var(--border-thin) solid transparent;
            text-align: left;
        }

        nav a:hover {
            border-color: var(--color-accent1);
            background-color: var(--color-bg);
        }

        nav p.desc {
            display: block;
        }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
        .megamenu {
            transition: opacity 0.001s linear;
            transform: none;
        }

        .megamenu:not(.open) {
            opacity: 0;
            transform: none;
        }

        button.menu-toggle:active svg {
            transform: none;
        }
    }
</style>

<script src="/scripts/megamenu.js" defer></script>
