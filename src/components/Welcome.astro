---
import { Image } from 'astro:assets';
import deskImage from '../assets/images/desk.webp';
import VinylSpinningSVG from './icons/SpinningVinyl.svg';
---

<section>
    <Image
        src={deskImage}
        alt="My cozy desk space"
        class="welcome-desk"
        loading="lazy"
        decoding="async"
        width={1500}
        height={2000}
    />

    <div class="intro-text">
        <h1>Hi there</h1>

        <p>
            I'm
            <b>Flipse</b>
            <span class="pronouns">(she/her)</span>
            — a very excited tinkerer.
        </p>

        <p>
            I have worked on Tumblr
            <a
                href="https://mournstera.tumblr.com/"
                target="_blank"
                rel="noopener noreferrer">themes</a
            >
            for 15 years, but

            <a
                href="https://techcrunch.com/2024/02/22/tumblr-ceo-publicly-spars-with-trans-user-over-account-ban-revealing-private-account-names-in-the-process/"
                target="_blank"
                rel="noopener noreferrer">now</a
            >
            it's time to set
            <a
                href="https://changes.tumblr.com/post/797397804182044672/"
                target="_blank"
                rel="noopener noreferrer">sails</a
            >
            elsewhere. I started my first blog in 2000; we return to the old ship,
            learning better code.
        </p>

        <p>I'm an early disability retiree, so all this is just for kicks!</p>

        <div id="scrobble" aria-label="Latest scrobbled track">
            <div class="vinyl-wrap" aria-hidden="true">
                <VinylSpinningSVG />
            </div>
            <a
                class="track"
                href="https://listenbrainz.org/user/flipse"
                target="_blank"
                rel="noopener noreferrer"
            >
            </a>
        </div>
    </div>
</section>

<style>
    /* ----- Section layout ----- */
    section {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
        align-items: center;
    }

    /* ----- Desktop image ----- */
    img.welcome-desk {
        width: 100%;
        border-radius: var(--radius-md);
        object-fit: cover;
        display: block;
        aspect-ratio: 3 / 2;
    }

    :global([data-theme='dark']) img.welcome-desk {
        filter: brightness(0.85);
    }

    /* ----- Typography ----- */
    h1 {
        font-size: 2.6rem;
    }

    p {
        line-height: 1.5rem;
        margin: 1.5rem 0;
    }

    /* Links inside paragraphs  */
    .intro-text p a {
        text-decoration: underline;
        color: hsl(var(--text-primary));

        &:hover {
            color: hsl(var(--text-primary));
            text-decoration-style: wavy;
            text-decoration-color: hsl(var(--accent-primary));
        }
    }

    /* ----- Scrobble ----- */
    #scrobble {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        gap: 0.4rem;
    }

    .track {
        font-family: var(--font-mono);
        font-size: 0.875rem;
        display: inline-block;
        line-height: 1.3;
    }

    .vinyl-wrap {
        animation: spin 8s linear infinite;
        transform-origin: 50% 50%;
        backface-visibility: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        will-change: transform;
    }

    #scrobble svg {
        width: 1.25rem;
        height: 1.25rem;
        flex-shrink: 0;
        stroke-width: 1.6;
        filter: blur(0.05px);
    }

    #scrobble:hover .vinyl-wrap {
        animation-play-state: paused;
    }

    /* ----- Animations ----- */
    @keyframes spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360.1deg);
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .vinyl-wrap {
            animation: none;
        }
    }

    /* ----- Responsive / Media Queries -----  */
    @media (min-width: 425px) {
        #scrobble {
            flex-wrap: nowrap;
        }
    }

    @media (min-width: 580px) {
        section {
            grid-template-columns: 3fr 4fr;
            gap: 4rem;
        }

        img.welcome-desk {
            height: 100%;
            max-height: 100%;
            aspect-ratio: auto;
        }
    }
</style>

<script>
    // Scrobble (Listenbrainz)
    (async () => {
        const trackLink = document.querySelector('#scrobble .track');
        if (!trackLink) return;

        try {
            const res = await fetch(
                'https://api.listenbrainz.org/1/user/flipse/listens?count=1'
            );
            const t = (await res.json()).payload.listens?.[0]?.track_metadata;
            if (t) trackLink.textContent = `${t.track_name} — ${t.artist_name}`;
        } catch (e) {
            console.error('Failed to fetch ListenBrainz data:', e);
        }
    })();
</script>
